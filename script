function Export-ADUsers {
    $folderPath = "C:\Temporary"
    if (-not (Test-Path -Path $folderPath)) {
        New-Item -Path $folderPath -ItemType Directory
    }

    $users = Get-ADUser -Filter * -Property DisplayName, UserPrincipalName, EmailAddress, DistinguishedName, ObjectGUID |
             Select-Object DisplayName, UserPrincipalName, EmailAddress, 
             @{Name="OrganizationalUnit";Expression={
                 ($_.DistinguishedName -replace 'OU=', '' -replace 'CN=', '' -replace 'DC=', '') -split ',' -join '\'
             }}, ObjectGUID

    $users | Export-Csv -Path "C:\Temporary\users.csv" -NoTypeInformation
}
